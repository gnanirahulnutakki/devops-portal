{{- if and .Values.secrets.provider (eq .Values.secrets.provider "sealed-secrets") }}
# ============================================================================
# Sealed Secret - Bitnami Sealed Secrets
# ============================================================================
# Sealed Secrets allows you to encrypt secrets so they can be safely stored
# in Git repositories. The sealed-secrets controller in your cluster will
# decrypt them.
#
# Prerequisites:
#   - Sealed Secrets controller installed: 
#     kubectl apply -f https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.24.5/controller.yaml
#   - kubeseal CLI installed for encrypting secrets
#
# Usage:
#   1. Create a regular secret YAML
#   2. Encrypt with: kubeseal --format yaml < secret.yaml > sealed-secret.yaml
#   3. Set values.secrets.sealedSecrets.encryptedData with the encrypted values
# ============================================================================
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: {{ .Values.secrets.name }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "backstage-gitops.labels" . | nindent 4 }}
spec:
  encryptedData:
    {{- range $key, $value := .Values.secrets.sealedSecrets.encryptedData }}
    {{ $key }}: {{ $value | quote }}
    {{- end }}
  template:
    metadata:
      name: {{ $.Values.secrets.name }}
      namespace: {{ $.Release.Namespace }}
      labels:
        {{- include "backstage-gitops.labels" $ | nindent 8 }}
    type: Opaque
{{- end }}
