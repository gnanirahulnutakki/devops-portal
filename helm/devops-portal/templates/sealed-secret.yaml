{{- if .Values.secrets.useSealedSecrets }}
# =============================================================================
# Sealed Secrets Template
# 
# This is a TEMPLATE for creating sealed secrets.
# You must seal these secrets using kubeseal before applying.
#
# Steps:
# 1. Create a regular secret YAML with your values
# 2. Use kubeseal to encrypt: kubeseal --format yaml < secret.yaml > sealed-secret.yaml
# 3. Apply the sealed secret: kubectl apply -f sealed-secret.yaml
#
# Example:
#   kubeseal --controller-name=sealed-secrets \
#            --controller-namespace=kube-system \
#            --format yaml < devops-portal-secrets.yaml > devops-portal-sealed-secrets.yaml
# =============================================================================

# NOTE: The actual SealedSecret resources are NOT generated by Helm.
# They must be created manually and sealed using kubeseal.
# Below are helper ConfigMaps documenting the required secrets structure.

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "devops-portal.fullname" . }}-sealed-secrets-template
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "devops-portal.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "-10"
    "helm.sh/resource-policy": keep
data:
  # Template for main application secrets
  # Seal with: kubeseal --format yaml < this-file.yaml > sealed.yaml
  devops-portal-secrets.yaml: |
    apiVersion: v1
    kind: Secret
    metadata:
      name: {{ .Values.secrets.sealedSecretName | default "devops-portal-sealed-secrets" }}
      namespace: {{ .Release.Namespace }}
    type: Opaque
    stringData:
      # NextAuth secret (generate with: openssl rand -base64 32)
      NEXTAUTH_SECRET: "YOUR_NEXTAUTH_SECRET_HERE"
      
      # Encryption key for token storage (generate with: openssl rand -hex 32)
      ENCRYPTION_KEY: "YOUR_ENCRYPTION_KEY_HERE"
      
      # Database URL (if not using subchart)
      # DATABASE_URL: "postgresql://user:pass@host:5432/db?sslmode=require"
      
      # Redis URL (if not using subchart)
      # REDIS_URL: "redis://:password@host:6379"
  
  {{- if .Values.postgresql.enabled }}
  # PostgreSQL secrets template
  postgresql-secrets.yaml: |
    apiVersion: v1
    kind: Secret
    metadata:
      name: {{ .Values.postgresql.auth.existingSecret | default "devops-portal-postgresql-sealed" }}
      namespace: {{ .Release.Namespace }}
    type: Opaque
    stringData:
      postgres-password: "YOUR_POSTGRES_ADMIN_PASSWORD"
      password: "YOUR_POSTGRES_USER_PASSWORD"
  {{- end }}
  
  {{- if .Values.redis.enabled }}
  # Redis secrets template
  redis-secrets.yaml: |
    apiVersion: v1
    kind: Secret
    metadata:
      name: {{ .Values.redis.auth.existingSecret | default "devops-portal-redis-sealed" }}
      namespace: {{ .Release.Namespace }}
    type: Opaque
    stringData:
      redis-password: "YOUR_REDIS_PASSWORD"
  {{- end }}
  
  {{- if .Values.minio.enabled }}
  # MinIO secrets template
  minio-secrets.yaml: |
    apiVersion: v1
    kind: Secret
    metadata:
      name: {{ .Values.minio.auth.existingSecret | default "devops-portal-minio-sealed" }}
      namespace: {{ .Release.Namespace }}
    type: Opaque
    stringData:
      root-user: "admin"
      root-password: "YOUR_MINIO_PASSWORD"
  {{- end }}
  
  {{- if .Values.integrations.argocd.enabled }}
  # ArgoCD integration secrets template
  argocd-secrets.yaml: |
    apiVersion: v1
    kind: Secret
    metadata:
      name: {{ .Values.integrations.argocd.existingSecret | default "devops-portal-argocd-sealed" }}
      namespace: {{ .Release.Namespace }}
    type: Opaque
    stringData:
      token: "YOUR_ARGOCD_TOKEN"
  {{- end }}
  
  {{- if .Values.integrations.grafana.enabled }}
  # Grafana integration secrets template
  grafana-secrets.yaml: |
    apiVersion: v1
    kind: Secret
    metadata:
      name: {{ .Values.integrations.grafana.existingSecret | default "devops-portal-grafana-sealed" }}
      namespace: {{ .Release.Namespace }}
    type: Opaque
    stringData:
      api-key: "YOUR_GRAFANA_API_KEY"
  {{- end }}
  
  {{- if .Values.integrations.github.enabled }}
  # GitHub OAuth secrets template
  github-secrets.yaml: |
    apiVersion: v1
    kind: Secret
    metadata:
      name: {{ .Values.integrations.github.existingSecret | default "devops-portal-github-sealed" }}
      namespace: {{ .Release.Namespace }}
    type: Opaque
    stringData:
      client-id: "YOUR_GITHUB_CLIENT_ID"
      client-secret: "YOUR_GITHUB_CLIENT_SECRET"
  {{- end }}
  
  {{- if .Values.integrations.keycloak.enabled }}
  # Keycloak OIDC secrets template
  keycloak-secrets.yaml: |
    apiVersion: v1
    kind: Secret
    metadata:
      name: {{ .Values.integrations.keycloak.existingSecret | default "devops-portal-keycloak-sealed" }}
      namespace: {{ .Release.Namespace }}
    type: Opaque
    stringData:
      client-id: "YOUR_KEYCLOAK_CLIENT_ID"
      client-secret: "YOUR_KEYCLOAK_CLIENT_SECRET"
  {{- end }}
{{- end }}
